{% from "blocks/header.njk" import header with context %}
{% from "blocks/footer.njk" import footer with context %}
{% from "blocks/person-avatar.njk" import personAvatar %}
{% from "blocks/person-badges.njk" import personBadges %}

{% set behanceRegEx = r/behance.net/g %}
{% set githubRegEx = r/github.com/g %}
{% set twitterRegEx = r/twitter.com/g %}
{% set telegramRegEx = r/t.me/g %}

{% set linkIcon %}
<svg class="person-links-list__icon" width="12" height="12" viewBox="0 0 12 12" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.005" d="M4.99431778,6.50333588 C5.21026125,6.79230539 5.48577084,7.03144389 5.80217619,7.20444305 C6.11851113,7.37749254 6.46838533,7.48037596 6.82801457,7.50614714 C7.18759354,7.53196867 7.54853014,7.48002362 7.88628596,7.35388573 C8.22409207,7.22774785 8.53082283,7.03038686 8.78571106,6.77514137 L10.294223,5.26511086 C10.7522072,4.7904529 11.0056372,4.15472502 10.9999048,3.49484672 C10.9941725,2.83497345 10.7297304,2.20375049 10.2636002,1.73713093 C9.79746999,1.27051137 9.16686173,1.00582819 8.50764203,1.0000951 C7.84842232,0.994362022 7.2133388,1.24803205 6.73916323,1.70647228 L5.87428306,2.56718967"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.005" d="M7.005667,5.49664887 C6.78969837,5.20766427 6.51419382,4.96855093 6.19780858,4.79552157 C5.88147363,4.6224922 5.53159943,4.51959872 5.17199533,4.4938225 C4.81239627,4.46804125 4.45145965,4.51997623 4.11367366,4.64610909 C3.7758927,4.77223689 3.46915691,4.96961299 3.21427371,5.22484338 L1.7057618,6.73487389 C1.24778261,7.20952682 0.994367692,7.84524966 1.00009501,8.505133 C1.00582233,9.16501634 1.27023932,9.79625943 1.73638962,10.2628588 C2.20253991,10.7294583 2.83312807,10.9941666 3.49233771,10.9999047 C4.1515524,11.0056428 4.78664094,10.7519577 5.26082154,10.2935125 L6.12067333,9.43279508"/>
</svg>
{% endset %}

{% set behanceIcon %}
<svg class="person-links-list__icon" width="13" height="9" viewBox="0 0 13 9" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path d="M5.24652 3.6808C5.24652 3.6808 6.47677 3.58947 6.47677 2.14683C6.47677 0.704085 5.47027 0 4.19533 0H0V8.06226H4.19533C4.19533 8.06226 6.75643 8.14316 6.75643 5.68265C6.75643 5.68267 6.86809 3.6808 5.24652 3.6808V3.6808ZM3.89336 1.43298H4.19533C4.19533 1.43298 4.7656 1.43297 4.7656 2.27182C4.7656 3.11056 4.43022 3.23216 4.04981 3.23216H1.84852V1.43298H3.89336V1.43298ZM4.07678 6.62933H1.84852V4.47479H4.19533C4.19533 4.47479 5.04529 4.46365 5.04529 5.58201C5.04529 6.52503 4.41045 6.62221 4.07678 6.62933V6.62933ZM10.1721 2.05128C7.07161 2.05128 7.07436 5.14904 7.07436 5.14904C7.07436 5.14904 6.86163 8.2309 10.1721 8.2309C10.1721 8.2309 12.9308 8.3885 12.9308 6.08702H11.512C11.512 6.08702 11.5594 6.95372 10.2194 6.95372C10.2194 6.95372 8.80043 7.04882 8.80043 5.55107H12.9781C12.9781 5.55104 13.4352 2.05128 10.1721 2.05128ZM8.78484 4.47479C8.78484 4.47479 8.95808 3.23214 10.2036 3.23214C11.4489 3.23214 11.4333 4.47479 11.4333 4.47479H8.78484ZM11.7638 1.46778H8.4375V0.47497H11.7638V1.46778Z"/>
</svg>
{% endset %}

{% set githubIcon %}
<svg class="person-links-list__icon" width="11" height="11" viewBox="0 0 11 11" fill="currentColor">
  <path d="M5.5 0C2.461 0 0 2.523 0 5.638c0 2.492 1.577 4.604 3.761 5.351.274.052.375-.12.375-.273l-.007-.959c-1.53.34-1.853-.754-1.853-.754-.25-.651-.611-.828-.611-.828-.5-.35.037-.342.037-.342.55.041.844.581.844.581.49.862 1.286.613 1.6.468.05-.364.193-.613.348-.755-1.219-.138-2.502-.623-2.502-2.783 0-.616.213-1.118.567-1.512-.057-.146-.246-.717.05-1.492 0 0 .463-.152 1.513.578a5.214 5.214 0 0 1 1.378-.19c.466.003.939.065 1.378.19 1.05-.73 1.512-.578 1.512-.578.3.775.112 1.35.054 1.492.351.394.564.896.564 1.512 0 2.167-1.286 2.641-2.512 2.783.196.173.375.52.375 1.045 0 .755-.007 1.36-.007 1.547 0 .153.098.326.378.27C9.427 10.242 11 8.13 11 5.642 11 2.523 8.539 0 5.5 0Z" />
</svg>
{% endset %}

{% set twitterIcon %}
<svg class="person-links-list__icon" width="11" height="11"  viewBox="0 0 1200 1227" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill="currentColor" d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"/>
</svg>
{% endset %}

{% set telegramIcon %}
<svg class="person-links-list__icon" width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle fill="#2AABEE" cx="5.5" cy="5.5" r="5.5"/>
  <path fill-rule="evenodd" clip-rule="evenodd" d="M2.48961 5.44194C4.09297 4.74338 5.16213 4.28285 5.69709 4.06034C7.2245 3.42504 7.54188 3.31468 7.74875 3.31104C7.79424 3.31024 7.89597 3.32151 7.96187 3.37498C8.01751 3.42013 8.03282 3.48112 8.04015 3.52393C8.04747 3.56674 8.0566 3.66425 8.04935 3.74045C7.96657 4.61013 7.60843 6.72061 7.42622 7.69467C7.34912 8.10683 7.19732 8.24502 7.05035 8.25855C6.73095 8.28794 6.48842 8.04747 6.17907 7.84469C5.695 7.52737 5.42153 7.32984 4.95165 7.0202C4.40863 6.66236 4.76065 6.46568 5.07011 6.14425C5.1511 6.06014 6.55837 4.78012 6.5856 4.664C6.58901 4.64948 6.59217 4.59535 6.56001 4.56676C6.52785 4.53818 6.48039 4.54796 6.44614 4.55573C6.39759 4.56675 5.62428 5.07788 4.12621 6.08912C3.9067 6.23985 3.70789 6.31328 3.52975 6.30944C3.33337 6.30519 2.95562 6.1984 2.6748 6.10712C2.33036 5.99515 2.05661 5.93596 2.08045 5.74581C2.09286 5.64677 2.22925 5.54548 2.48961 5.44194Z" fill="#FFF"/>
</svg>
{% endset %}

{% set issuesIcon %}
<svg class="person-links-list__icon" width="10" height="10" viewBox="0 0 10 10">
  <circle cx="5" cy="5" r="4.5" stroke="currentColor" fill="none"/>
  <circle cx="5" cy="5" r="1" fill="currentColor"/>
</svg>
{% endset %}

{% set prIcon %}
<svg class="person-links-list__icon" width="10" height="11" viewBox="0 0 10 11" fill="none" stroke="currentColor">
  <circle cx="1.875" cy="2.875" r="1.375" />
  <circle cx="1.875" cy="9.125" r="1.375" />
  <circle cx="8.125" cy="9.125" r="1.375" />
  <path d="M5 2.563h2.125a1 1 0 0 1 1 1v4.312"/>
  <path d="M6.25 1 4.687 2.563 6.25 4.125M1.875 4.125v3.75"/>
</svg>
{% endset %}

{{ header(
  pageCategoryId='people',
  category=categoryName,
  title=name,
  isCategoryVisible=true
) }}

<div class="person-page">
  <main class="person-page__main" id="main-content">
    <div class="person-page__avatar">
      {{ personAvatar(
        photoURL = photo,
        photoAlt = photoAlt,
        name = name,
        category = mostContributedCategory
      ) }}
    </div>

    <div class="person-page__header">
      <h1 class="person-page__title">
        {{ name }}
      </h1>
      {% if roles %}
        <div class="person-page__roles">
          {% for role in roles %}
            <a href="{{ role.url }}" class="person-page__roles-link" style="--role-color: {{ role.color }}; --role-bg-color: {{ role.bgColor }}; --role-hover-color: {{ role.hoverColor }}; --role-border-color: {{ role.border }};">
              {{ role.title }}
            </a>
          {% endfor %}
        </div>
      {% endif %}
      {% if person.templateContent %}
        <div class="person-page__description content">
          {{ person.templateContent | safe }}
        </div>
      {% endif %}
    </div>

    <div class="person-page__meta">
      <div class="person-page__badges">
        {{ personBadges(badges, badgesFields) }}
      </div>
      <ul class="base-list person-links-list font-theme font-theme--code">
        {% if url %}
          <li class="person-links-list__item">
            <a class="person-links-list__link person-links-list__link--own link" href="{{ url }}">
              {% if twitterRegEx.test(url) %}
                {{ twitterIcon | safe }}
                <span>{{ twitterId }}</span>
              {% elif githubRegEx.test(url) %}
                {{ githubIcon | safe }}
                <span>{{ personId }}</span>
              {% elif behanceRegEx.test(url) %}
                {{ behanceIcon | safe }}
                <span>{{ behanceId }}</span>
              {% elif telegramRegEx.test(url) %}
                {{ telegramIcon | safe }}
                <span>{{ telegramId }}</span>
              {% else %}
                {{ linkIcon | safe }}
                <span>{{ cutLink }}</span>
              {% endif %}
            </a>
          </li>
        {% endif %}
        {% if contributionStat.issues > 0 %}
          <li class="person-links-list__item">
            <a class="person-links-list__link link" href="{{ issuesLink }}">
              {{ githubIcon | safe }}
              {{ issuesIcon | safe }}
              <span>{{ contributionStat.issues }} {{ contributionStat.issues | pluralize('ишью', 'ишьюс', 'ишьюсов') }}</span>
            </a>
          </li>
        {% endif %}
        {% if contributionStat.pr > 0 %}
          <li class="person-links-list__item">
            <a class="person-links-list__link link" href="{{ pullRequestsLink }}">
              {{ githubIcon | safe }}
              {{ prIcon | safe }}
              <span>{{ contributionStat.pr }} {{ contributionStat.pr | pluralize('пулреквест', 'пулреквеста', 'пулреквестов') }}</span>
            </a>
          </li>
        {% endif %}
      </ul>
    </div>

    <div class="person-page__articles">
      {% for category, practicesByRole in articlesIndex %}
        <section class="person-page__group articles-group articles-group--accent articles-group--title-static" style="--accent-color: var(--color-{{ category }})">
          <h2 class="articles-group__title">
            {{ articleIndexesMap[category].data.name }}
          </h2>
          {% for personRole, articles in practicesByRole | dictsort %}
            <section class="articles-group__section">
              <h3 class="articles-group__sub-title font-theme font-theme--code">{{ personRole }}</h3>
              <ul class="articles-group__list base-list">
                {% for article in articles %}
                  <li>
                    <a class="articles-group__link link" href="/{{ category }}/{{ article.fileSlug }}/">
                      {{ article.data.title | descriptionMarkdown | safe }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </section>
          {% endfor %}
          {% if practicesIndex[category] | length %}
            <section class="articles-group__section">
              <h3 class="articles-group__sub-title font-theme font-theme--code">{{ practicesPersonRole }}</h3>
              <ul class="articles-group__list base-list">
                {% for practice in practicesIndex[category] %}
                  <li>
                    <a class="articles-group__link link" href="/{{ category }}/{{ practice.fileSlug }}/#na-praktike">
                      {{ practice.data.title | descriptionMarkdown | safe }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}
          {% if answersInArticles[category] | length %}
            <section class="articles-group__section">
              <h3 class="articles-group__sub-title font-theme font-theme--code">{{ answersPersonRole }}</h3>
              <ul class="articles-group__list base-list">
                {% for articleList in answersInArticles[category] %}
                  <ul class="articles-group__list base-list">
                    {% for article in articleList | sort %}
                      <li>
                        <a class="articles-group__link link" href="/{{ category }}/{{ article.fileSlug }}/#na-sobesedovanii">
                          {{ article.data.title | descriptionMarkdown | safe }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endfor %}
              </ul>
            </section>
          {% endif %}
        </section>
      {% endfor %}
      {% if isOnlyWithPractice %}
        {% for category in categoriesOnlyWithPractice %}
          <section class="person-page__group articles-group articles-group--accent articles-group--title-static" style="--accent-color: var(--color-{{ category }})">
            <h2 class="articles-group__title">
              {{ articleIndexesMap[category].data.name }}
            </h2>
            <h3 class="articles-group__sub-title font-theme font-theme--code">{{ practicesPersonRole }}</h3>
            <ul class="articles-group__list base-list">
              {% for practice in practicesIndex[category] | sort %}
                <li>
                  <a class="articles-group__link link" href="/{{ category }}/{{ practice.fileSlug }}/#na-praktike">
                    {{ practice.data.title | descriptionMarkdown | safe }}
                  </a>
                </li>
              {% endfor %}
            <ul>
          </section>
        {% endfor %}
      {% endif %}
      {% if isOnlyWithAnswer %}
        {% for category in categoriesOnlyWithAnswers %}
          <section class="person-page__group articles-group articles-group--accent articles-group--title-static" style="--accent-color: var(--color-{{ category }})">
            <h2 class="articles-group__title">
              {{ articleIndexesMap[category].data.name }}
            </h2>
            <h3 class="articles-group__sub-title font-theme font-theme--code">{{ answersPersonRole }}</h3>
            <ul class="articles-group__list base-list">
              {% for articleList in answersInArticles[category] %}
                {% for article in articleList | sort %}
                  <li>
                    <a class="articles-group__link link" href="/{{ category }}/{{ article.fileSlug }}/#na-sobesedovanii">
                      {{ article.data.title | descriptionMarkdown | safe }}
                    </a>
                  </li>
                {% endfor %}
              {% endfor %}
            </ul>
          </section>
        {% endfor %}
      {% endif %}
    </div>
  </main>

</div>

{{ footer() }}
{% include "subscribe-popup.njk" %}
